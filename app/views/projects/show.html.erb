<% content_for :head do %>
  <meta name="title" content="<%= @project.title %>" />
  <meta name="description" content="<%= @project.description %>" />
  <link rel="image_src" href="<%= project_icon_path @project, :big %>" />
<% end %>

<div id="project_show">
  <div class="project_action_links">
    <% if @u && (@project.owner == @u || @u.is_admin) %>
      <div class="button left"><%= link_to "Edit project", edit_project_path(@project) %></div>
      <div class="button left"><%= link_to "Delete Project", {:controller => "admin/deleted_projects", :action => "delete", :id => @project}, :confirm => "Are You Sure?" %></div>
    <% end %>
    <% if @u && @u.is_admin && @project.budget_reached? %>
      <div class="button left">
      <%= link_to "#{@project.green_light ? "Revoke" : "Award"} Green", :action => "update_green_light", :id => @project.id %></div>
    <% end %>
  </div>

  <div class="pmf_clear">&nbsp;</div>

  <div class="dashed_light_border">&nbsp;</div>

  <%= render :partial => "project", :locals => {:project => @project} %>

  <div class="pmf_clear">&nbsp;</div>

  <div class="left">
    <%= render :partial => "subscription_buttons" %>
  </div>

  <div class="pmf_clear">&nbsp;</div>

  <div class="view-lite-row-description">
    <span class="header">Project Logline:</span>
    <span class="body">
      <%= h @project.description %>
    </span>
  </div>

  <% if @project.latest_project_comment %>
    <div class="pmf_clear">&nbsp;</div>

    <div class="view-lite-row-description">
      <span class="header">
        <a name="pmf_comment">
          Latest PMF Fund Project Comment:
        </a>
      </span>

      <div class="top_share_buttons">
        <div class="tweet_button">
          <script type="text/javascript">
            tweetmeme_url = '<%= url_for :only_path => false, :controller => "project_comments",
    :action => "show", :id => @project.latest_project_comment.id, :anchor => "pmf_comment" %>';
          </script>
          <script type="text/javascript" src="http://tweetmeme.com/i/scripts/button.js"></script>
        </div>

        <div class="facebook_button">
          <a name="fb_share" type="box_count" share_url="<%= url_for :only_path => false,
               :controller => "project_comments", :action => "show", :id => @project.latest_project_comment.id, :anchor => "pmf_comment" %>"
             href="http://www.facebook.com/sharer.php">Share</a>
          <script src="http://static.ak.fbcdn.net/connect.php/js/FB.Share" type="text/javascript"></script>
        </div>
      </div>

      <span class="body">
        <%= h @project.latest_project_comment.body %>
      </span>
    </div>
  <% end %>

  <div class="pmf_clear">&nbsp;</div>

  <div class="view-lite-row-description latest_blog">
    <span class="header">Latest Blog Entry:</span>
    <% if @latest_project_blog %>
      <span class="date"><%= @latest_project_blog.created_at.to_formatted_s(:long_ordinal) %></span>
      <span class="body">
        <%= truncate(h(@latest_project_blog.title), 50) %>
        <%= link_to "...(more)", {:controller => "blogs", :action => "show", :id => @latest_project_blog.id} unless @latest_project_blog.title.length < 51 %>
      </span>
      <span class="comments_link"><%= link_to "#{pluralize(@latest_project_blog.num_comments, "comment")}", :controller => "blogs", :action => "show", :id => @latest_project_blog.id %></span>
    <% else %>
      <span class="body">No Blogs Found!</span>
    <% end %>
  </div>

  <div class="pmf_clear">&nbsp;</div>

  <div class="view-lite-row-description">
    <span class="header">Synopsis:</span>
    <span class="body">
      <%=h @project.synopsis %>
    </span>
  </div>

  <div class="pmf_clear">&nbsp;</div>

  <div class="view-lite-row-description">
    <span class="header">Cast:</span>
    <span class="body">
      <%=h @project.cast %>
    </span>
  </div>

  <div class="pmf_clear">&nbsp;</div>

  <div class="view-lite-row-description">
    <span class="header">Site Address:</span>
    <span class="body">
      <a href="<%=h @project.web_address %>" target="_blank"><%=h @project.web_address %></a>
    </span>
  </div>

  <div class="pmf_clear">&nbsp;</div>

  <div id="project_blogs">
    <fieldset>
      <div class="header">Latest Project Blogs</div>
      <div class="links">
        <% if @project_blogs %>
          <div class="button left">
            <%= link_to "All Blogs", {:controller => "projects", :action => "blogs", :id => @project.id} %>
          </div>
        <% end %>
        <% if @u && (@project.owner == @u || @u.is_admin) %>
          <div class="button left">
            <%= link_to "New Blog", :controller => :blogs, :action => :new, :project_id => @project.id %>
          </div>
        <% end %>
      </div>
      <ol>
        <li>
          <%= render :partial => 'blogs/blogs', :locals => {:blogs => @project_blogs} %>
        </li>
      </ol>
    </fieldset>
  </div>

  <div id="project_comments">
    <fieldset>
      <div class="header">Latest PMF Fund Project Comments</div>
      <div class="links">
        <% if @project_comments %>
          <div class="button left">
            <%= link_to "All Comments", project_project_comments_path(@project) %>
          </div>
        <% end %>
      </div>
      <ol>
        <li>
          <% if @project_comments %>
            <%= render :partial => 'project_comments/comments', :locals => {:project_comments => @project_comments} %>
          <% else %>
            No Comments Found!
          <% end %>
        </li>
      </ol>
    </fieldset>
  </div>

  <% if_admin do %>
    <% form_for  @project, :url => {:action => "update_symbol", :id => @project.id} do |f| %>
      <fieldset>
        <div class="header">Project Symbol</div>
        <div class="subheader">
          <b>Note:</b> Symbol must be 5 characters long and
          must consist of all letters
        </div>
        <ol>
          <li>
            <label>Enter a symbol for project</label>
            <%= f.text_field :symbol, {:size => 30, :maxlength => 5} %>
            <%= display_error_on(@project, :symbol) -%>
            <%= submit_tag "Submit" %>
          </li>
        </ol>
      </fieldset>
    <% end %>
  <% end %>

  <% if_admin do %>
    <% form_tag :controller => "admin/project_rating", :action => "rate", :project_id => @project.id do %>
      <fieldset>
        <div class="header">PMF Fund Rating</div>
        <ol>
          <li id="comment">
            <label>Add a Comment</label>
            <%= text_area_tag :body, nil, :size => "45x5" %>
          </li>
          <li>
            <label>Set Rating</label>
            <%= select_tag  "rating", options_for_select(@admin_rating_select_opts, @selected_admin_rating) %>
            <%= submit_tag "Submit" %>
          </li>
        </ol>
      </fieldset>
    <% end %>
  <% end %>

  <div class="pmf_clear">&nbsp;</div>

  <a name="user_rating">&nbsp;</a>

  <% form_tag :controller => "project_rating", :action => "rate", :project_id => @project.id do %>
    <fieldset>
      <div class="header">Member Rating</div>
      <div class="subheader"><b>Note:</b> You can only change your rating once per day</div>
      <ol>
        <li><label>Member Rating:</label><%= @project.user_rating %></li>
        <% if logged_in %>
          <% if @my_project_rating %>
            <li>
              <label>Your current rating:</label>
              <%= @my_project_rating.rating %>
            </li>
          <% end %>
          <% if @allowed_to_rate %>
            <li>
              <label>Set Your Rating:</label>
              <%= select_tag "rating", options_for_select(@rating_select_opts, @selected_my_project_rating) %>
              <input type="submit" name="submit" value="Submit"/>
            </li>
          <% end %>
        <% else %>
          <li>
            <label>You must <%= link_to "Log In", login_path %> to rate this project!</label>
          </li>
        <% end %>
      </ol>
    </fieldset>
  <% end %>

  <% if @project.subscribers.length > 0 %>
    <div class="pageTitle">Members Reserving Copies</div>
    <div class="pmf_clear_bottom_border">&nbsp;</div>

    <div class="users">
      <% for s in @project.subscribers do %>
          <div class="user-icon">
            <%= link_to icon(s.profile, :small), profile_path(s.profile) %>
            <span><%= link_to s.profile.user.login, profile_path(s.profile) %></span>
          </div>
        <% end %>
      </div>

      <div class="pmf_clear_bottom_border">&nbsp;</div>
    <% end %>
  </div>